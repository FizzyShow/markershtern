### Проблема:
  Решение о взаимодействие фасада с другими микросервисами по grpc вызывает вопросы:  
  - Общение напрямую через grpc вызывает несостыковки в общей архитектуре.  
  - Также это порождает проблему взаимодействия фасада с клиентами (где клиенты - Blazor, Mobile app...),  где нужно общаться с микрсоервисами по grpc, а с клиентами по rest. Необходимо будет решить как это все совместить в одном микросервисе.
  
  
### Решение:  
  Описание логики взаимодействий:  
Все сообщения, в том числе от фасада и к фасаду, будут идти через Kafka.  
Предполагается следующее взаимодействие:  
Для запросов данных, мы формируем два топика. Один топик для сообщения ответа, откуда читать будем. Другой топик для сообщения, чтобы нам сформировали данные.  
  
Абстрактная схема:  
```mermaid
stateDiagram-v2
    Фасад  --> ТопикЗапроса:head = token(21) \n key = 3\n messageValue = idUser
    ТопикЗапроса --> Партиция: head = token(21) \n key = 3\n messageValue = idUser
    Партиция --> МикросервисПортфеля: head = token(21) \n key = 3\n messageValue = idUser
    МикросервисПортфеля --> ТопикОтвета: head = token(21) \n key = 3\n messageValue = listProduct 
    ТопикОтвета --> Партиция1
    ТопикОтвета --> Партиция2   
    ТопикОтвета --> Партиция3 : head = token(21) \n key = 3\n message = listProduct 
    Партиция3 -->  Фасад : head = token(21) \n key = 3\n message = listProduct      
```
Запрос приходит в один топик, в одну партицию (опционально), откуда на конкурентной основе, сообщения будут разбирать консюмеры.  

Сообщение состоит из header key messageValue  
header будет хранить в себе следующую конструкцию (key = токен, value = null)  
где токен будет уникальная случайная строка.  
header Будет отвечать за указатель, кому это сообщение адресовано. Сервисы будет ждать ответы только с header  и токеном который они сами сгенерировали для себя.  
key будет отвечать за то, в какую партицию будет доставлен ответ, на эту партицию и будем формировать консюмер.  
messageValue хранит тело сообщения
Например там могут быть idUser для запроса списка продуктов.  
А ответное MessageValue, будет состоять из товаров по этому IdUser. 

Можно предположить стандартное кол партиций 5. Для топика который будет содержать ответ. 

> В таком варианте решения фасад будет взаимодействовать с сервисами только по kafka, соотвественно не нужно будет решать проблему совместимости grpc и rest
  
  
### Проблема:
 - Сбор правил взаимодействия между сервисами по нескольким адр вызывает конфликты и недопонимание.  
  
  
### Решение:  
  [Доска взаимодействий](https://miro.com/app/board/uXjVOiQGoYc=/?share_link_id=112559324980)  

  
