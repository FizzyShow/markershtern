ProductService ("Просмотр общего списка товаров, доступных для торговли")

adr by ted7007

Статус:  
 * Предложено

Проблема:  

Мироксервис с товарами.  Основная задача, модель товара.  
Небходимо рассмотреть взаимодействие микросервиса с кафкой - сообщения, негативные сценарии, ошибки между сервисами
Также стоит вопрос о модели товара, взаимодействии сервиса товара с mongoDB


Решение:

Микросервис работает с уникальными товарами  
  >Уникальность товара заключается в названии, не может быть две разновидности товара с одинаковым именем  
Микросервис будет создавать уникальные товары, выводить их по id или списком.

Модель товара: 

	{
		[BSON.ObjectID]
		string Id
		[unique]
		string Name 
	}
Наш микросервис подписан на топик , пусть будет NewProductRequest, куда будут приходить события на создание нового товара,
предположительно запросы будут идти из микроервиса портфеля.
Как я вижу процесс получения запросов и общение с кафкой используя proto:
Микросервис товаров опрашивает топик на новые сообщения.
Каждое полученное сообщение будет десериализовыаться из байтовых значений в c#-objs используя десериализатор на основе proto NewProductRequest

	message NewProductRequest
	{
		string Name = 1;
	}
После того как сообщение было получено и десериализовано, через сервис продуктов, у которого будет доступ к контексту БД, проверяется название нового продукта на уникальность.  
Если товар не повторяет другое название - он успешно добавляется в список уникальных товаров, сервис возвращает id нового товара в БД и затем формируется ответ.  
Если товар повторяет другое название - то добавление его в список отклоняется и также формируется ответ
	
	message NewProductResponce
	{
		bool IsAccepted = 1;

		string Id = 2;

		string Name = 3;
	}
Если товар уникален - IsAccepted имеет значение true, остальные поля также заполняются в соответствии с id 
Иначе IsAccepted равно false значению, а остальные поля не заполняются (дефолт).  
Ответ десериализуется также используя сериализацию на основе proto файла в байтовые значения.
Теперь микросервис отправляет бинарное сообщение в ответный топик, пусть будет NewProductResponce.  

По поводу получения продюсером и консюмером proto файлов - я нашел решение, где эти proto файлы подключаются к каждому микросервису как библиотека.

Применение функции, которая будет возвращать товар по id я сейчас не вижу. А вот список товаров может использовать например микросервис заявок, когда будет спрашивать у пользователя название товара для оформления заявки.  
Получение списка уникальных товаров:
Работа с сериализацией сообщений аналогичная. Но поменяются сообщения, топики и появляется вопрос о передаче коллекций данных.  
Запрос пусть будет приходить в топик AllProductsRequest.  
Ответ будет приходить в топик AllProductsResponce, где вероятно будет несколько консюмеров (например сервис заявок и каких-нибудь других мониторингов).
Сообщения запроса и ответа списка товаров:

	message AllProductsRequest
	{
		
	}
	
	message AllProductsResponce
	{
		repeated ProductResponce = 1;
	}
	
	message ProductResponce
	{
		string Id = 2;

		string Name = 3;
	}
	
Альтернативные вариант ответного сообщения:
Передача нужного кол-ва следующих сообщений, количество можно например регулировать в запросе.

	message ProductResponce
	{
		string Id = 2;

		string Name = 3;
	}
Такое решение позволяет контролировать размер сообщения, когда выбранное мною решение отправляет все товары разом.  
 > Не вижу применения альтернативному варианту, ведь обычно требуются именно полный список уникальных продуктов
---  
В работе ещё две проблемы - проблемы вывода списка товаров, доступных для торговли и проблема получения данных фасадом
